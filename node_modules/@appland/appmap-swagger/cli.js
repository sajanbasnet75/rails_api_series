#!/usr/bin/env node
/* eslint-disable no-console */

const yargs = require('yargs');
const { hideBin } = require('yargs/helpers');
const process = require('process');
const yaml = require('yaml');
const { verbose } = require('./settings');
const Command = require('./command');

// eslint-disable-next-line no-unused-expressions
yargs(hideBin(process.argv))
  .command(
    'generate',
    'Generate Swagger from AppMaps in a directory',
    (args) => {
      args.option('directory', {
        describe: 'directory to recursively inspect for AppMaps',
        default: 'tmp/appmap',
      });
    },
    async (argv) => {
      verbose(argv.verbose);

      const swagger = await new Command(argv.directory).execute();
      console.log(yaml.stringify(swagger));
    }
  )
  .demandCommand()
  .option('verbose', {
    alias: 'v',
    type: 'boolean',
    description: 'Run with verbose logging',
  })
  .help().argv;
