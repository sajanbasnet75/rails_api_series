{
  "version": "1.4",
  "metadata": {
    "app": "nytem-2021/appland",
    "language": {
      "name": "ruby",
      "engine": "ruby",
      "version": "2.6.6"
    },
    "client": {
      "name": "appmap",
      "url": "https://github.com/applandinc/appmap-ruby",
      "version": "0.42.0"
    },
    "frameworks": [
      {
        "name": "rails",
        "version": "5.2.4.2"
      },
      {
        "name": "rspec",
        "version": "3.9.1"
      }
    ],
    "git": {
      "repository": "git@github.com:applandinc/appland.git",
      "branch": "swagger",
      "commit": "d82ba25ed71e5086c39becb3a3ae2cfc2a3571b6",
      "status": [
        "M Gemfile.lock",
        "?? 20210310072459.appmap.json"
      ],
      "git_last_annotated_tag": null,
      "git_last_tag": "v0.22.0",
      "git_commits_since_last_annotated_tag": null,
      "git_commits_since_last_tag": 0
    },
    "name": "API::ScenariosController .search logged in retrieves expected scenario data with code_objects",
    "source_location": "spec/requests/api_scenarios_search_spec.rb",
    "recorder": {
      "name": "rspec"
    },
    "fingerprints": [
      {
        "appmap_digest": "9483ae89b941937f67cbc46f0c388607e6933aacf6b5407c471ae0e9f0ab83ee",
        "canonicalization_algorithm": "update_v1",
        "digest": "f9809b7fdf4fa7d731b6b3aa2582d6c736e8f7b0bdc82959cde6e629b19d51bb",
        "fingerprint_algorithm": "sha256"
      },
      {
        "appmap_digest": "9483ae89b941937f67cbc46f0c388607e6933aacf6b5407c471ae0e9f0ab83ee",
        "canonicalization_algorithm": "trace_v1",
        "digest": "3d12cec703cb55130fe3e68fe454fd315debf5a0c011b4851f103fb1b450d686",
        "fingerprint_algorithm": "sha256"
      },
      {
        "appmap_digest": "9483ae89b941937f67cbc46f0c388607e6933aacf6b5407c471ae0e9f0ab83ee",
        "canonicalization_algorithm": "info_v1",
        "digest": "d31527e093432a0b5f0361308939f2f18c766fee31b7523ee762b9f0cb0a44a5",
        "fingerprint_algorithm": "sha256"
      }
    ]
  },
  "classMap": [
    {
      "name": "app/models",
      "type": "package",
      "children": [
        {
          "name": "ApiKey",
          "type": "class",
          "children": [
            {
              "name": "issue",
              "type": "function",
              "location": "app/models/api_key.rb:28",
              "static": true,
              "source": "    def issue(login, description: nil, encode: true)\n      api_key = DAO::ApiKey.new.tap do |api_key|\n        api_key.login = login\n        api_key.description = description if description.present?\n        api_key.save\n      end\n\n      return encode(api_key) if encode\n\n      api_key\n    end\n"
            },
            {
              "name": "encode",
              "type": "function",
              "location": "app/models/api_key.rb:20",
              "static": true,
              "source": "    def encode(api_key)\n      Base64.urlsafe_encode64([api_key.login, api_key.key].join(SEPARATOR), padding: false)\n    end\n"
            },
            {
              "name": "authenticate",
              "type": "function",
              "location": "app/models/api_key.rb:52",
              "static": true,
              "labels": [
                "provider.authentication"
              ],
              "comment": "# @labels provider.authentication\n",
              "source": "    def authenticate(api_key)\n      login, key = decode(api_key)\n      result = DAO::ApiKey.where(login: login).match(key)\n\n      if result.present?\n        touch(result)\n        User::Show.new(result.user)\n      else\n        nil\n      end\n    end\n"
            },
            {
              "name": "decode",
              "type": "function",
              "location": "app/models/api_key.rb:24",
              "static": true,
              "source": "    def decode(api_key)\n      Base64.urlsafe_decode64(api_key).split(SEPARATOR)\n    end\n"
            },
            {
              "name": "touch",
              "type": "function",
              "location": "app/models/api_key.rb:11",
              "static": true,
              "source": "    def touch(api_key)\n      if api_key.last_used.nil? || api_key.last_used > 15.minutes.ago\n        api_key.last_used = Time.now\n        api_key.save_changes\n      end\n\n      api_key\n    end\n"
            }
          ]
        },
        {
          "name": "Scenario",
          "type": "class",
          "children": [
            {
              "name": "SearchActions",
              "type": "class",
              "children": [
                {
                  "name": "search_api",
                  "type": "function",
                  "location": "app/models/scenario.rb:66",
                  "static": false,
                  "source": "    def search_api(params)\n      matching_scenarios = base_dataset_filter.select(Sequel.as(:id, :scenario_id))\n      search_params = %w[mapsets code_objects labels not_labels not_code_objects]\n      params.each do |key, value|\n        if search_params.include?(key) && value.present?\n          matching_scenarios = matching_scenarios.public_send(\"filter_by_#{key}\", value)\n        end\n      end\n\n      query = Sequel::Model.db[:matching_scenarios]\n        .with(:matching_scenarios, matching_scenarios)\n        .join(:scenarios, [[Sequel[:scenarios][:id], Sequel[:matching_scenarios][:scenario_id]]])\n        .select(:mapset_id, :uuid)\n        .group_by(:mapset_id, :uuid, :labels)\n\n      # If labels were requested, calculate the intersection between labels requested and\n      # labels present on the scenario. Otherwise, null.\n      if params[:labels].present?\n        query = query.select_append(\n          Sequel.as(\n            Sequel.lit('ARRAY(SELECT UNNEST(labels) INTERSECT SELECT UNNEST(?))', Sequel.pg_array(params[:labels])),\n            :labels\n          )\n        )\n      else\n        query = query.select_append(Sequel.as(nil, :labels))\n      end\n\n      # Don't bother joining objects that aren't in the requested code_objects. Otherwise,\n      # we won't return the intersection between the code objects requested and the code\n      # objects in the scenario.\n      if params[:code_objects].present?\n        code_object_join_conditions = [\n          Sequel.lit('scenario_code_objects.scenario_id = matching_scenarios.scenario_id'),\n          Sequel.expr { { object_name: params[:code_objects] } }\n        ]\n\n        query = query.select_append(\n          Sequel.as(\n            Sequel.lit('array_agg(object_name)'),\n            :object_names\n          )\n        ).inner_join(:scenario_code_objects, code_object_join_conditions.reduce(&:&))\n      end\n\n      query = Sequel::Model.db[:scenarios]\n                .join(query.as(:subquery), [[Sequel[:scenarios][:uuid], Sequel[:subquery][:uuid]]])\n                .select(Sequel.lit('subquery.*'), :metadata)\n      query.map do |row|\n        ApiItem.new(row[:mapset_id], row[:uuid], row[:object_names] || [], row[:metadata], row[:labels] || [])\n      end\n    end\n"
                }
              ]
            }
          ]
        },
        {
          "name": "Search",
          "type": "class",
          "children": [
            {
              "name": "filter",
              "type": "function",
              "location": "app/models/search.rb:33",
              "static": false,
              "source": "  def filter(dataset, table_name: nil)\n    # Don't hide anything from an admin\n    # This should be replaced at some point with a proper impersonation system\n    return dataset if user&.admin?\n\n    DAO::PublicResource.coerce(dataset)\n                       .scope(user, scope: scope)\n  end\n"
            }
          ]
        },
        {
          "name": "User",
          "type": "class",
          "children": [
            {
              "name": "Show",
              "type": "class",
              "children": [
                {
                  "name": "admin?",
                  "type": "function",
                  "location": "app/models/user.rb:106",
                  "static": false,
                  "source": "    def admin?\n      @user.admin\n    end\n"
                }
              ]
            }
          ]
        },
        {
          "name": "DAO",
          "type": "class",
          "children": [
            {
              "name": "PublicResource",
              "type": "class",
              "children": [
                {
                  "name": "coerce",
                  "type": "function",
                  "location": "app/models/dao/public_resource.rb:18",
                  "static": true,
                  "comment": "# Coerce a dataset to a type that is safe to invoke scope.\n",
                  "source": "    def self.coerce(dataset)\n      if dataset.is_a?(PublicResource)\n        dataset\n      else\n        UnscopableResource.new(dataset)\n      end\n    end\n"
                },
                {
                  "name": "scope",
                  "type": "function",
                  "location": "app/models/dao/public_resource.rb:26",
                  "static": true,
                  "source": "    def scope(user, scope: Search::SCOPE_MEMBERSHIP)\n      if user\n        user = DAO::User[user.id]\n      else\n        raise Exceptions::Forbidden if scope == Search::SCOPE_MEMBERSHIP\n      end\n\n      case scope\n      when Search::SCOPE_MEMBERSHIP\n        dataset.scope_membership(user)\n      when Search::SCOPE_PUBLIC\n        dataset.scope_public\n      when Search::SCOPE_LISTABLE\n        dataset.scope_listable(user)\n      when Search::SCOPE_FINDABLE\n        dataset.scope_findable(user)\n      end\n    end\n"
                }
              ]
            },
            {
              "name": "SequelUtil",
              "type": "class",
              "children": [
                {
                  "name": "build_where_clause",
                  "type": "function",
                  "location": "app/models/dao/sequel_util.rb:6",
                  "static": true,
                  "source": "      def build_where_clause(dataset, clauses)\n        dataset = dataset.where(clauses.shift)\n        clauses.each do |clause|\n          dataset = dataset.or(clause)\n        end\n        dataset\n      end\n"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "action_pack",
      "type": "package",
      "children": [
        {
          "name": "ActionDispatch",
          "type": "class",
          "children": [
            {
              "name": "Cookies",
              "type": "class",
              "children": [
                {
                  "name": "CookieJar",
                  "type": "class",
                  "children": [
                    {
                      "name": "update",
                      "type": "function",
                      "location": "/Users/kgilpin/tmp/appland/vendor/bundle/ruby/2.6.0/gems/actionpack-5.2.4.2/lib/action_dispatch/middleware/cookies.rb:344",
                      "static": false,
                      "labels": [
                        "provider.http.cookie"
                      ],
                      "source": "      def update(other_hash)\n        @cookies.update other_hash.stringify_keys\n        self\n      end\n"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "app/controllers",
      "type": "package",
      "children": [
        {
          "name": "AnonymousAccess",
          "type": "class",
          "children": [
            {
              "name": "anonymous_access?",
              "type": "function",
              "location": "app/controllers/concerns/anonymous_access.rb:9",
              "static": false,
              "source": "  def anonymous_access?\n    @anonymous_access\n  end\n"
            }
          ]
        },
        {
          "name": "API",
          "type": "class",
          "children": [
            {
              "name": "ScenariosController",
              "type": "class",
              "children": [
                {
                  "name": "index",
                  "type": "function",
                  "location": "app/controllers/api/scenarios_controller.rb:17",
                  "static": false,
                  "source": "    def index\n      raise Exceptions::InvalidArguments.new('search', 'mapsets are required') unless params[:mapsets].present?\n\n      validate_params_intersection('labels', 'not_labels')\n      validate_params_intersection('code_objects', 'not_code_objects')\n\n      scenarios = search_scope(Scenario, scope: Search::SCOPE_MEMBERSHIP).search_api(params)\n      render json: scenarios, status: :ok\n    end\n"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "json",
      "type": "package",
      "children": [
        {
          "name": "JSON",
          "type": "class",
          "children": [
            {
              "name": "Ext",
              "type": "class",
              "children": [
                {
                  "name": "Parser",
                  "type": "class",
                  "children": [
                    {
                      "name": "parse",
                      "type": "function",
                      "location": "JSON::Ext::Parser#parse",
                      "static": false,
                      "labels": [
                        "format.json",
                        "provider.serialization"
                      ]
                    }
                  ]
                },
                {
                  "name": "Generator",
                  "type": "class",
                  "children": [
                    {
                      "name": "State",
                      "type": "class",
                      "children": [
                        {
                          "name": "generate",
                          "type": "function",
                          "location": "JSON::Ext::Generator::State#generate",
                          "static": false,
                          "labels": [
                            "format.json",
                            "provider.serialization"
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
  ],
  "events": [
    {
      "id": 63897,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "ApiKey",
      "method_id": "issue",
      "path": "app/models/api_key.rb",
      "lineno": 28,
      "static": true,
      "parameters": [
        {
          "name": "login",
          "class": "String",
          "object_id": 70222274173780,
          "value": "alice",
          "kind": "req"
        },
        {
          "name": "description",
          "class": "NilClass",
          "object_id": 8,
          "value": null,
          "kind": "key"
        },
        {
          "name": "encode",
          "class": "NilClass",
          "object_id": 8,
          "value": null,
          "kind": "key"
        }
      ],
      "receiver": {
        "class": "Class",
        "object_id": 70222285939160,
        "value": "ApiKey"
      }
    },
    {
      "id": 63898,
      "event": "call",
      "thread_id": 70223206228000,
      "sql_query": {
        "sql": "INSERT INTO \"api_keys\" (\"login\") VALUES ('alice') RETURNING *",
        "database_type": "postgres",
        "server_version": 120003
      }
    },
    {
      "id": 63899,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63898,
      "elapsed": 0.001609
    },
    {
      "id": 63900,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "ApiKey",
      "method_id": "encode",
      "path": "app/models/api_key.rb",
      "lineno": 20,
      "static": true,
      "parameters": [
        {
          "name": "api_key",
          "class": "DAO::ApiKey",
          "object_id": 70221867840380,
          "value": "#<DAO::ApiKey:0x00007fbb9af9e6f8>",
          "kind": "req"
        }
      ],
      "receiver": {
        "class": "Class",
        "object_id": 70222285939160,
        "value": "ApiKey"
      }
    },
    {
      "id": 63901,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63900,
      "elapsed": 0.000019,
      "return_value": {
        "class": "String",
        "value": "YWxpY2U6YTFhZjhhZGYtODM3NC00MzY0LWEzYzYtOTQwYTllZjRmYjhj",
        "object_id": 70221743648640
      }
    },
    {
      "id": 63902,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63897,
      "elapsed": 0.005618,
      "return_value": {
        "class": "String",
        "value": "YWxpY2U6YTFhZjhhZGYtODM3NC00MzY0LWEzYzYtOTQwYTllZjRmYjhj",
        "object_id": 70221743648640
      }
    },
    {
      "id": 63903,
      "event": "call",
      "thread_id": 70223206228000,
      "http_server_request": {
        "request_method": "GET",
        "path_info": "/api/scenarios",
        "normalized_path_info": "/api/scenarios(.:format)",
        "authorization": "Bearer YWxpY2U6YTFhZjhhZGYtODM3NC00MzY0LWEzYzYtOTQwYTllZjRmYjhj"
      },
      "message": [
        {
          "name": "code_objects",
          "class": "Array",
          "value": "[\"controllers/SessionsController#delete\"]",
          "object_id": 70221743694600
        },
        {
          "name": "mapsets",
          "class": "Array",
          "value": "[\"100001\"]",
          "object_id": 70221743694560
        },
        {
          "name": "controller",
          "class": "String",
          "value": "api/scenarios",
          "object_id": 70222270836680
        },
        {
          "name": "action",
          "class": "String",
          "value": "index",
          "object_id": 70222270839940
        }
      ]
    },
    {
      "id": 63904,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "ActionDispatch::Cookies::CookieJar",
      "method_id": "update",
      "path": "/Users/kgilpin/tmp/appland/vendor/bundle/ruby/2.6.0/gems/actionpack-5.2.4.2/lib/action_dispatch/middleware/cookies.rb",
      "lineno": 344,
      "static": false,
      "parameters": [
        {
          "name": "other_hash",
          "class": "Hash",
          "object_id": 70221743644700,
          "value": "{}",
          "kind": "req"
        }
      ],
      "receiver": {
        "class": "ActionDispatch::Cookies::CookieJar",
        "object_id": 70221743716660,
        "value": "#<ActionDispatch::Cookies::CookieJar:0x00007fbb8c2df268>"
      }
    },
    {
      "id": 63905,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63904,
      "elapsed": 0.000009,
      "return_value": {
        "class": "ActionDispatch::Cookies::CookieJar",
        "value": "#<ActionDispatch::Cookies::CookieJar:0x00007fbb8c2df268>",
        "object_id": 70221743716660
      }
    },
    {
      "id": 63906,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "AnonymousAccess",
      "method_id": "anonymous_access?",
      "path": "app/controllers/concerns/anonymous_access.rb",
      "lineno": 9,
      "static": false,
      "parameters": [],
      "receiver": {
        "class": "API::ScenariosController",
        "object_id": 70221743683780,
        "value": "#<API::ScenariosController:0x00007fbb8c2cf188>"
      }
    },
    {
      "id": 63907,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63906,
      "elapsed": 0.000008
    },
    {
      "id": 63908,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "ApiKey",
      "method_id": "authenticate",
      "path": "app/models/api_key.rb",
      "lineno": 52,
      "static": true,
      "parameters": [
        {
          "name": "api_key",
          "class": "String",
          "object_id": 70221743711620,
          "value": "YWxpY2U6YTFhZjhhZGYtODM3NC00MzY0LWEzYzYtOTQwYTllZjRmYjhj",
          "kind": "req"
        }
      ],
      "receiver": {
        "class": "Class",
        "object_id": 70222285939160,
        "value": "ApiKey"
      }
    },
    {
      "id": 63909,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "ApiKey",
      "method_id": "decode",
      "path": "app/models/api_key.rb",
      "lineno": 24,
      "static": true,
      "parameters": [
        {
          "name": "api_key",
          "class": "String",
          "object_id": 70221743711620,
          "value": "YWxpY2U6YTFhZjhhZGYtODM3NC00MzY0LWEzYzYtOTQwYTllZjRmYjhj",
          "kind": "req"
        }
      ],
      "receiver": {
        "class": "Class",
        "object_id": 70222285939160,
        "value": "ApiKey"
      }
    },
    {
      "id": 63910,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63909,
      "elapsed": 0.000013,
      "return_value": {
        "class": "Array",
        "value": "[\"alice\", \"a1af8adf-8374-4364-a3c6-940a9ef4fb8c\"]",
        "object_id": 70221743731280
      }
    },
    {
      "id": 63911,
      "event": "call",
      "thread_id": 70223206228000,
      "sql_query": {
        "sql": "SELECT * FROM \"api_keys\" WHERE (\"login\" = 'alice')",
        "database_type": "postgres",
        "server_version": 120003
      }
    },
    {
      "id": 63912,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63911,
      "elapsed": 0.001336
    },
    {
      "id": 63913,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "ApiKey",
      "method_id": "touch",
      "path": "app/models/api_key.rb",
      "lineno": 11,
      "static": true,
      "parameters": [
        {
          "name": "api_key",
          "class": "DAO::ApiKey",
          "object_id": 70222274536640,
          "value": "#<DAO::ApiKey:0x00007fbbcb754980>",
          "kind": "req"
        }
      ],
      "receiver": {
        "class": "Class",
        "object_id": 70222285939160,
        "value": "ApiKey"
      }
    },
    {
      "id": 63914,
      "event": "call",
      "thread_id": 70223206228000,
      "sql_query": {
        "sql": "UPDATE \"api_keys\" SET \"last_used\" = '2021-03-27 15:38:35.500342+0000' WHERE (\"id\" = 2)",
        "database_type": "postgres",
        "server_version": 120003
      }
    },
    {
      "id": 63915,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63914,
      "elapsed": 0.001197
    },
    {
      "id": 63916,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63913,
      "elapsed": 0.005943,
      "return_value": {
        "class": "DAO::ApiKey",
        "value": "#<DAO::ApiKey:0x00007fbbcb754980>",
        "object_id": 70222274536640
      }
    },
    {
      "id": 63917,
      "event": "call",
      "thread_id": 70223206228000,
      "sql_query": {
        "sql": "SELECT * FROM \"users\" WHERE (\"users\".\"login\" = 'alice') LIMIT 1",
        "database_type": "postgres",
        "server_version": 120003
      }
    },
    {
      "id": 63918,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63917,
      "elapsed": 0.000968
    },
    {
      "id": 63919,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63908,
      "elapsed": 0.017275,
      "return_value": {
        "class": "User::Show",
        "value": "#<User::Show:0x00007fbbcb373c80>",
        "object_id": 70222272503360
      }
    },
    {
      "id": 63920,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "API::ScenariosController",
      "method_id": "index",
      "path": "app/controllers/api/scenarios_controller.rb",
      "lineno": 17,
      "static": false,
      "parameters": [],
      "receiver": {
        "class": "API::ScenariosController",
        "object_id": 70221743683780,
        "value": "#<API::ScenariosController:0x00007fbb8c2cf188>"
      }
    },
    {
      "id": 63921,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "Scenario::SearchActions",
      "method_id": "search_api",
      "path": "app/models/scenario.rb",
      "lineno": 66,
      "static": false,
      "parameters": [
        {
          "name": "params",
          "class": "ActionController::Parameters",
          "object_id": 70222272501580,
          "value": "{\"code_objects\"=>[\"controllers/SessionsController#delete\"], \"mapsets\"=>[\"100001\"], \"controller\"=>\"ap",
          "kind": "req"
        }
      ],
      "receiver": {
        "class": "Scenario::Search",
        "object_id": 70222272500840,
        "value": "#<Scenario::Search:0x00007fbbcb3728d0>"
      }
    },
    {
      "id": 63922,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "Search",
      "method_id": "filter",
      "path": "app/models/search.rb",
      "lineno": 33,
      "static": false,
      "parameters": [
        {
          "name": "dataset",
          "class": "Class",
          "object_id": 70223077321880,
          "value": "DAO::Scenario",
          "kind": "req"
        },
        {
          "name": "table_name",
          "class": "NilClass",
          "object_id": 8,
          "value": null,
          "kind": "key"
        }
      ],
      "receiver": {
        "class": "Scenario::Search",
        "object_id": 70222272500840,
        "value": "#<Scenario::Search:0x00007fbbcb3728d0>"
      }
    },
    {
      "id": 63923,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "User::Show",
      "method_id": "admin?",
      "path": "app/models/user.rb",
      "lineno": 106,
      "static": false,
      "parameters": [],
      "receiver": {
        "class": "User::Show",
        "object_id": 70222272503360,
        "value": "#<User::Show:0x00007fbbcb373c80>"
      }
    },
    {
      "id": 63924,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63923,
      "elapsed": 0.000008
    },
    {
      "id": 63925,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "DAO::PublicResource",
      "method_id": "coerce",
      "path": "app/models/dao/public_resource.rb",
      "lineno": 18,
      "static": true,
      "parameters": [
        {
          "name": "dataset",
          "class": "Class",
          "object_id": 70223077321880,
          "value": "DAO::Scenario",
          "kind": "req"
        }
      ],
      "receiver": {
        "class": "Module",
        "object_id": 70222284109120,
        "value": "DAO::PublicResource"
      }
    },
    {
      "id": 63926,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63925,
      "elapsed": 0.000006,
      "return_value": {
        "class": "Class",
        "value": "DAO::Scenario",
        "object_id": 70223077321880
      }
    },
    {
      "id": 63927,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "DAO::PublicResource",
      "method_id": "scope",
      "path": "app/models/dao/public_resource.rb",
      "lineno": 26,
      "static": true,
      "parameters": [
        {
          "name": "user",
          "class": "User::Show",
          "object_id": 70222272503360,
          "value": "#<User::Show:0x00007fbbcb373c80>",
          "kind": "req"
        },
        {
          "name": "scope",
          "class": "Integer",
          "object_id": 3,
          "value": "1",
          "kind": "key"
        }
      ],
      "receiver": {
        "class": "Class",
        "object_id": 70223077321880,
        "value": "DAO::Scenario"
      }
    },
    {
      "id": 63928,
      "event": "call",
      "thread_id": 70223206228000,
      "sql_query": {
        "sql": "SELECT * FROM \"users\" WHERE \"id\" = 1000001",
        "database_type": "postgres",
        "server_version": 120003
      }
    },
    {
      "id": 63929,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63928,
      "elapsed": 0.000958
    },
    {
      "id": 63930,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "DAO::SequelUtil",
      "method_id": "build_where_clause",
      "path": "app/models/dao/sequel_util.rb",
      "lineno": 6,
      "static": true,
      "parameters": [
        {
          "name": "dataset",
          "class": "Sequel::Postgres::Dataset",
          "object_id": 70222284481180,
          "value": "#<Sequel::Postgres::Dataset:0x00007fbbcca4c538>",
          "kind": "req"
        },
        {
          "name": "clauses",
          "class": "Array",
          "object_id": 70221744151920,
          "value": "[{:org=>#<Sequel::Postgres::Dataset: \"SELECT \\\"orgs\\\".* FROM \\\"orgs\\\" INNER JOIN \\\"users_orgs\\\" ON (",
          "kind": "req"
        }
      ],
      "receiver": {
        "class": "Module",
        "object_id": 70222406546920,
        "value": "DAO::SequelUtil"
      }
    },
    {
      "id": 63931,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63930,
      "elapsed": 0.000025,
      "return_value": {
        "class": "Sequel::Postgres::Dataset",
        "value": "#<Sequel::Postgres::Dataset:0x00007fbb8c3b2528>",
        "object_id": 70221744149140
      }
    },
    {
      "id": 63932,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63927,
      "elapsed": 0.005209,
      "return_value": {
        "class": "Sequel::Postgres::Dataset",
        "value": "#<Sequel::Postgres::Dataset:0x00007fbb8c3b1c68>",
        "object_id": 70221744148020
      }
    },
    {
      "id": 63933,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63922,
      "elapsed": 0.005488,
      "return_value": {
        "class": "Sequel::Postgres::Dataset",
        "value": "#<Sequel::Postgres::Dataset:0x00007fbb8c3b1c68>",
        "object_id": 70221744148020
      }
    },
    {
      "id": 63934,
      "event": "call",
      "thread_id": 70223206228000,
      "sql_query": {
        "sql": "SELECT subquery.*, \"metadata\" FROM \"scenarios\" INNER JOIN (WITH \"matching_scenarios\" AS (SELECT \"id\" AS \"scenario_id\" FROM \"scenarios\" WHERE (((\"scenarios\".\"org_id\" IN (SELECT \"orgs\".\"id\" FROM \"orgs\" INNER JOIN \"users_orgs\" ON (\"users_orgs\".\"org_id\" = \"orgs\".\"id\") WHERE ((\"users_orgs\".\"user_id\" = 1000001) AND (\"orgs\".\"id\" IS NOT NULL)))) OR (\"scenarios\".\"mapset_id\" IN (SELECT \"mapsets\".\"id\" FROM \"mapsets\" WHERE ((\"mapsets\".\"app_id\" IN (SELECT \"apps\".\"id\" FROM \"apps\" WHERE ((\"apps\".\"org_id\" IN (SELECT \"orgs\".\"id\" FROM \"orgs\" INNER JOIN \"users_orgs\" ON (\"users_orgs\".\"org_id\" = \"orgs\".\"id\") WHERE ((\"users_orgs\".\"user_id\" = 1000001) AND (\"orgs\".\"id\" IS NOT NULL)))) AND (\"apps\".\"id\" IS NOT NULL)))) AND (\"mapsets\".\"id\" IS NOT NULL))))) AND (EXISTS (SELECT 1 FROM \"scenario_code_objects\" WHERE ((\"scenario_id\" = \"scenarios\".\"id\") AND (\"object_name\" IN ('controllers/SessionsController#delete'))) LIMIT 1)) AND (\"mapset_id\" IN ('100001')))) SELECT \"mapset_id\", \"uuid\", NULL AS \"labels\", array_agg(object_name) AS \"object_names\" FROM \"matching_scenarios\" INNER JOIN \"scenarios\" ON (\"scenarios\".\"id\" = \"matching_scenarios\".\"scenario_id\") INNER JOIN \"scenario_code_objects\" ON (scenario_code_objects.scenario_id = matching_scenarios.scenario_id AND (\"object_name\" IN ('controllers/SessionsController#delete'))) GROUP BY \"mapset_id\", \"uuid\", \"labels\") AS \"subquery\" ON (\"scenarios\".\"uuid\" = \"subquery\".\"uuid\")",
        "database_type": "postgres",
        "server_version": 120003
      }
    },
    {
      "id": 63935,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63934,
      "elapsed": 0.00584
    },
    {
      "id": 63936,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "JSON::Ext::Parser",
      "method_id": "parse",
      "path": "JSON::Ext::Parser#parse",
      "static": false,
      "parameters": [],
      "receiver": {
        "class": "JSON::Ext::Parser",
        "object_id": 70221734225040,
        "value": "#<JSON::Ext::Parser:0x00007fbb8b0c4920>"
      }
    },
    {
      "id": 63937,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63936,
      "elapsed": 0.000009,
      "return_value": {
        "class": "Hash",
        "value": "{\"labels\"=>[\"label1\", \"positive\"]}",
        "object_id": 70221734224060
      }
    },
    {
      "id": 63938,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "JSON::Ext::Parser",
      "method_id": "parse",
      "path": "JSON::Ext::Parser#parse",
      "static": false,
      "parameters": [],
      "receiver": {
        "class": "JSON::Ext::Parser",
        "object_id": 70221734247700,
        "value": "#<JSON::Ext::Parser:0x00007fbb8b0cfa28>"
      }
    },
    {
      "id": 63939,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63938,
      "elapsed": 0.000006,
      "return_value": {
        "class": "Hash",
        "value": "{\"labels\"=>[\"label2\", \"positive\"]}",
        "object_id": 70221734246720
      }
    },
    {
      "id": 63940,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63921,
      "elapsed": 0.015989,
      "return_value": {
        "class": "Array",
        "value": "[#<struct Scenario::ApiItem mapset_id=100001, scenario_uuid=\"724151a3-cc7b-4ef3-ac6b-5380fe59217d\", ",
        "object_id": 70221744165860
      }
    },
    {
      "id": 63941,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "JSON::Ext::Generator::State",
      "method_id": "generate",
      "path": "JSON::Ext::Generator::State#generate",
      "static": false,
      "parameters": [
        {
          "name": "arg",
          "class": "Array",
          "object_id": 70221734242700,
          "value": "[{\"mapset_id\"=>100001, \"scenario_uuid\"=>\"724151a3-cc7b-4ef3-ac6b-5380fe59217d\", \"code_objects\"=>[\"co",
          "kind": "req"
        }
      ],
      "receiver": {
        "class": "JSON::Ext::Generator::State",
        "object_id": 70221734241580,
        "value": "#<JSON::Ext::Generator::State:0x00007fbb8b0cca58>"
      }
    },
    {
      "id": 63942,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63941,
      "elapsed": 0.000054,
      "return_value": {
        "class": "String",
        "value": "[{\"mapset_id\":100001,\"scenario_uuid\":\"724151a3-cc7b-4ef3-ac6b-5380fe59217d\",\"code_objects\":[\"control",
        "object_id": 70221734262080
      }
    },
    {
      "id": 63943,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63920,
      "elapsed": 0.016497,
      "return_value": {
        "class": "String",
        "value": "[{\"mapset_id\":100001,\"scenario_uuid\":\"724151a3-cc7b-4ef3-ac6b-5380fe59217d\",\"code_objects\":[\"control",
        "object_id": 70221734262080
      }
    },
    {
      "id": 63944,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63903,
      "elapsed": 0.034994,
      "http_server_response": {
        "status": 200,
        "mime_type": "application/json; charset=utf-8"
      }
    },
    {
      "id": 63945,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "JSON::Ext::Parser",
      "method_id": "parse",
      "path": "JSON::Ext::Parser#parse",
      "static": false,
      "parameters": [],
      "receiver": {
        "class": "JSON::Ext::Parser",
        "object_id": 70221734279640,
        "value": "#<JSON::Ext::Parser:0x00007fbb8b0df3b0>"
      }
    },
    {
      "id": 63946,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63945,
      "elapsed": 0.000016,
      "return_value": {
        "class": "Array",
        "value": "[{\"mapset_id\"=>100001, \"scenario_uuid\"=>\"724151a3-cc7b-4ef3-ac6b-5380fe59217d\", \"code_objects\"=>[\"co",
        "object_id": 70221734278500
      }
    },
    {
      "id": 63947,
      "event": "call",
      "thread_id": 70223206228000,
      "http_server_request": {
        "request_method": "GET",
        "path_info": "/api/scenarios",
        "normalized_path_info": "/api/scenarios(.:format)",
        "authorization": "Bearer YWxpY2U6YTFhZjhhZGYtODM3NC00MzY0LWEzYzYtOTQwYTllZjRmYjhj"
      },
      "message": [
        {
          "name": "code_objects",
          "class": "Array",
          "value": "[\"models/Session.delete\", \"models/User.find\"]",
          "object_id": 70221734366720
        },
        {
          "name": "mapsets",
          "class": "Array",
          "value": "[\"100001\"]",
          "object_id": 70221734366680
        },
        {
          "name": "controller",
          "class": "String",
          "value": "api/scenarios",
          "object_id": 70222270836680
        },
        {
          "name": "action",
          "class": "String",
          "value": "index",
          "object_id": 70222270839940
        }
      ]
    },
    {
      "id": 63948,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "ActionDispatch::Cookies::CookieJar",
      "method_id": "update",
      "path": "/Users/kgilpin/tmp/appland/vendor/bundle/ruby/2.6.0/gems/actionpack-5.2.4.2/lib/action_dispatch/middleware/cookies.rb",
      "lineno": 344,
      "static": false,
      "parameters": [
        {
          "name": "other_hash",
          "class": "Hash",
          "object_id": 70222271731220,
          "value": "{}",
          "kind": "req"
        }
      ],
      "receiver": {
        "class": "ActionDispatch::Cookies::CookieJar",
        "object_id": 70221734363860,
        "value": "#<ActionDispatch::Cookies::CookieJar:0x00007fbb8b1085a8>"
      }
    },
    {
      "id": 63949,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63948,
      "elapsed": 0.000006,
      "return_value": {
        "class": "ActionDispatch::Cookies::CookieJar",
        "value": "#<ActionDispatch::Cookies::CookieJar:0x00007fbb8b1085a8>",
        "object_id": 70221734363860
      }
    },
    {
      "id": 63950,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "AnonymousAccess",
      "method_id": "anonymous_access?",
      "path": "app/controllers/concerns/anonymous_access.rb",
      "lineno": 9,
      "static": false,
      "parameters": [],
      "receiver": {
        "class": "API::ScenariosController",
        "object_id": 70221734283780,
        "value": "#<API::ScenariosController:0x00007fbb8b0e1408>"
      }
    },
    {
      "id": 63951,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63950,
      "elapsed": 0.000006
    },
    {
      "id": 63952,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "ApiKey",
      "method_id": "authenticate",
      "path": "app/models/api_key.rb",
      "lineno": 52,
      "static": true,
      "parameters": [
        {
          "name": "api_key",
          "class": "String",
          "object_id": 70221734383320,
          "value": "YWxpY2U6YTFhZjhhZGYtODM3NC00MzY0LWEzYzYtOTQwYTllZjRmYjhj",
          "kind": "req"
        }
      ],
      "receiver": {
        "class": "Class",
        "object_id": 70222285939160,
        "value": "ApiKey"
      }
    },
    {
      "id": 63953,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "ApiKey",
      "method_id": "decode",
      "path": "app/models/api_key.rb",
      "lineno": 24,
      "static": true,
      "parameters": [
        {
          "name": "api_key",
          "class": "String",
          "object_id": 70221734383320,
          "value": "YWxpY2U6YTFhZjhhZGYtODM3NC00MzY0LWEzYzYtOTQwYTllZjRmYjhj",
          "kind": "req"
        }
      ],
      "receiver": {
        "class": "Class",
        "object_id": 70222285939160,
        "value": "ApiKey"
      }
    },
    {
      "id": 63954,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63953,
      "elapsed": 0.000009,
      "return_value": {
        "class": "Array",
        "value": "[\"alice\", \"a1af8adf-8374-4364-a3c6-940a9ef4fb8c\"]",
        "object_id": 70221734380520
      }
    },
    {
      "id": 63955,
      "event": "call",
      "thread_id": 70223206228000,
      "sql_query": {
        "sql": "SELECT * FROM \"api_keys\" WHERE (\"login\" = 'alice')",
        "database_type": "postgres",
        "server_version": 120003
      }
    },
    {
      "id": 63956,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63955,
      "elapsed": 0.001396
    },
    {
      "id": 63957,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "ApiKey",
      "method_id": "touch",
      "path": "app/models/api_key.rb",
      "lineno": 11,
      "static": true,
      "parameters": [
        {
          "name": "api_key",
          "class": "DAO::ApiKey",
          "object_id": 70221756314320,
          "value": "#<DAO::ApiKey:0x00007fbb8dae65a0>",
          "kind": "req"
        }
      ],
      "receiver": {
        "class": "Class",
        "object_id": 70222285939160,
        "value": "ApiKey"
      }
    },
    {
      "id": 63958,
      "event": "call",
      "thread_id": 70223206228000,
      "sql_query": {
        "sql": "UPDATE \"api_keys\" SET \"last_used\" = '2021-03-27 15:38:35.536652+0000' WHERE (\"id\" = 2)",
        "database_type": "postgres",
        "server_version": 120003
      }
    },
    {
      "id": 63959,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63958,
      "elapsed": 0.001216
    },
    {
      "id": 63960,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63957,
      "elapsed": 0.005229,
      "return_value": {
        "class": "DAO::ApiKey",
        "value": "#<DAO::ApiKey:0x00007fbb8dae65a0>",
        "object_id": 70221756314320
      }
    },
    {
      "id": 63961,
      "event": "call",
      "thread_id": 70223206228000,
      "sql_query": {
        "sql": "SELECT * FROM \"users\" WHERE (\"users\".\"login\" = 'alice') LIMIT 1",
        "database_type": "postgres",
        "server_version": 120003
      }
    },
    {
      "id": 63962,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63961,
      "elapsed": 0.001141
    },
    {
      "id": 63963,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63952,
      "elapsed": 0.01549,
      "return_value": {
        "class": "User::Show",
        "value": "#<User::Show:0x00007fbb8b1ba8e8>",
        "object_id": 70221734728820
      }
    },
    {
      "id": 63964,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "API::ScenariosController",
      "method_id": "index",
      "path": "app/controllers/api/scenarios_controller.rb",
      "lineno": 17,
      "static": false,
      "parameters": [],
      "receiver": {
        "class": "API::ScenariosController",
        "object_id": 70221734283780,
        "value": "#<API::ScenariosController:0x00007fbb8b0e1408>"
      }
    },
    {
      "id": 63965,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "Scenario::SearchActions",
      "method_id": "search_api",
      "path": "app/models/scenario.rb",
      "lineno": 66,
      "static": false,
      "parameters": [
        {
          "name": "params",
          "class": "ActionController::Parameters",
          "object_id": 70221734727080,
          "value": "{\"code_objects\"=>[\"models/Session.delete\", \"models/User.find\"], \"mapsets\"=>[\"100001\"], \"controller\"=",
          "kind": "req"
        }
      ],
      "receiver": {
        "class": "Scenario::Search",
        "object_id": 70221734726400,
        "value": "#<Scenario::Search:0x00007fbb8b1b9600>"
      }
    },
    {
      "id": 63966,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "Search",
      "method_id": "filter",
      "path": "app/models/search.rb",
      "lineno": 33,
      "static": false,
      "parameters": [
        {
          "name": "dataset",
          "class": "Class",
          "object_id": 70223077321880,
          "value": "DAO::Scenario",
          "kind": "req"
        },
        {
          "name": "table_name",
          "class": "NilClass",
          "object_id": 8,
          "value": null,
          "kind": "key"
        }
      ],
      "receiver": {
        "class": "Scenario::Search",
        "object_id": 70221734726400,
        "value": "#<Scenario::Search:0x00007fbb8b1b9600>"
      }
    },
    {
      "id": 63967,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "User::Show",
      "method_id": "admin?",
      "path": "app/models/user.rb",
      "lineno": 106,
      "static": false,
      "parameters": [],
      "receiver": {
        "class": "User::Show",
        "object_id": 70221734728820,
        "value": "#<User::Show:0x00007fbb8b1ba8e8>"
      }
    },
    {
      "id": 63968,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63967,
      "elapsed": 0.000006
    },
    {
      "id": 63969,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "DAO::PublicResource",
      "method_id": "coerce",
      "path": "app/models/dao/public_resource.rb",
      "lineno": 18,
      "static": true,
      "parameters": [
        {
          "name": "dataset",
          "class": "Class",
          "object_id": 70223077321880,
          "value": "DAO::Scenario",
          "kind": "req"
        }
      ],
      "receiver": {
        "class": "Module",
        "object_id": 70222284109120,
        "value": "DAO::PublicResource"
      }
    },
    {
      "id": 63970,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63969,
      "elapsed": 0.000005,
      "return_value": {
        "class": "Class",
        "value": "DAO::Scenario",
        "object_id": 70223077321880
      }
    },
    {
      "id": 63971,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "DAO::PublicResource",
      "method_id": "scope",
      "path": "app/models/dao/public_resource.rb",
      "lineno": 26,
      "static": true,
      "parameters": [
        {
          "name": "user",
          "class": "User::Show",
          "object_id": 70221734728820,
          "value": "#<User::Show:0x00007fbb8b1ba8e8>",
          "kind": "req"
        },
        {
          "name": "scope",
          "class": "Integer",
          "object_id": 3,
          "value": "1",
          "kind": "key"
        }
      ],
      "receiver": {
        "class": "Class",
        "object_id": 70223077321880,
        "value": "DAO::Scenario"
      }
    },
    {
      "id": 63972,
      "event": "call",
      "thread_id": 70223206228000,
      "sql_query": {
        "sql": "SELECT * FROM \"users\" WHERE \"id\" = 1000001",
        "database_type": "postgres",
        "server_version": 120003
      }
    },
    {
      "id": 63973,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63972,
      "elapsed": 0.000932
    },
    {
      "id": 63974,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "DAO::SequelUtil",
      "method_id": "build_where_clause",
      "path": "app/models/dao/sequel_util.rb",
      "lineno": 6,
      "static": true,
      "parameters": [
        {
          "name": "dataset",
          "class": "Sequel::Postgres::Dataset",
          "object_id": 70222284481180,
          "value": "#<Sequel::Postgres::Dataset:0x00007fbbcca4c538>",
          "kind": "req"
        },
        {
          "name": "clauses",
          "class": "Array",
          "object_id": 70221734921880,
          "value": "[{:org=>#<Sequel::Postgres::Dataset: \"SELECT \\\"orgs\\\".* FROM \\\"orgs\\\" INNER JOIN \\\"users_orgs\\\" ON (",
          "kind": "req"
        }
      ],
      "receiver": {
        "class": "Module",
        "object_id": 70222406546920,
        "value": "DAO::SequelUtil"
      }
    },
    {
      "id": 63975,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63974,
      "elapsed": 0.000025,
      "return_value": {
        "class": "Sequel::Postgres::Dataset",
        "value": "#<Sequel::Postgres::Dataset:0x00007fbb8b223280>",
        "object_id": 70221734943040
      }
    },
    {
      "id": 63976,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63971,
      "elapsed": 0.004924,
      "return_value": {
        "class": "Sequel::Postgres::Dataset",
        "value": "#<Sequel::Postgres::Dataset:0x00007fbb8b222a10>",
        "object_id": 70221734941960
      }
    },
    {
      "id": 63977,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63966,
      "elapsed": 0.005176,
      "return_value": {
        "class": "Sequel::Postgres::Dataset",
        "value": "#<Sequel::Postgres::Dataset:0x00007fbb8b222a10>",
        "object_id": 70221734941960
      }
    },
    {
      "id": 63978,
      "event": "call",
      "thread_id": 70223206228000,
      "sql_query": {
        "sql": "SELECT subquery.*, \"metadata\" FROM \"scenarios\" INNER JOIN (WITH \"matching_scenarios\" AS (SELECT \"id\" AS \"scenario_id\" FROM \"scenarios\" WHERE (((\"scenarios\".\"org_id\" IN (SELECT \"orgs\".\"id\" FROM \"orgs\" INNER JOIN \"users_orgs\" ON (\"users_orgs\".\"org_id\" = \"orgs\".\"id\") WHERE ((\"users_orgs\".\"user_id\" = 1000001) AND (\"orgs\".\"id\" IS NOT NULL)))) OR (\"scenarios\".\"mapset_id\" IN (SELECT \"mapsets\".\"id\" FROM \"mapsets\" WHERE ((\"mapsets\".\"app_id\" IN (SELECT \"apps\".\"id\" FROM \"apps\" WHERE ((\"apps\".\"org_id\" IN (SELECT \"orgs\".\"id\" FROM \"orgs\" INNER JOIN \"users_orgs\" ON (\"users_orgs\".\"org_id\" = \"orgs\".\"id\") WHERE ((\"users_orgs\".\"user_id\" = 1000001) AND (\"orgs\".\"id\" IS NOT NULL)))) AND (\"apps\".\"id\" IS NOT NULL)))) AND (\"mapsets\".\"id\" IS NOT NULL))))) AND (EXISTS (SELECT 1 FROM \"scenario_code_objects\" WHERE ((\"scenario_id\" = \"scenarios\".\"id\") AND (\"object_name\" IN ('models/Session.delete', 'models/User.find'))) LIMIT 1)) AND (\"mapset_id\" IN ('100001')))) SELECT \"mapset_id\", \"uuid\", NULL AS \"labels\", array_agg(object_name) AS \"object_names\" FROM \"matching_scenarios\" INNER JOIN \"scenarios\" ON (\"scenarios\".\"id\" = \"matching_scenarios\".\"scenario_id\") INNER JOIN \"scenario_code_objects\" ON (scenario_code_objects.scenario_id = matching_scenarios.scenario_id AND (\"object_name\" IN ('models/Session.delete', 'models/User.find'))) GROUP BY \"mapset_id\", \"uuid\", \"labels\") AS \"subquery\" ON (\"scenarios\".\"uuid\" = \"subquery\".\"uuid\")",
        "database_type": "postgres",
        "server_version": 120003
      }
    },
    {
      "id": 63979,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63978,
      "elapsed": 0.004219
    },
    {
      "id": 63980,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "JSON::Ext::Parser",
      "method_id": "parse",
      "path": "JSON::Ext::Parser#parse",
      "static": false,
      "parameters": [],
      "receiver": {
        "class": "JSON::Ext::Parser",
        "object_id": 70221735440040,
        "value": "#<JSON::Ext::Parser:0x00007fbb8b315d50>"
      }
    },
    {
      "id": 63981,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63980,
      "elapsed": 0.000018,
      "return_value": {
        "class": "Hash",
        "value": "{\"git\"=>{\"branch\"=>\"test\", \"commit\"=>\"4c7a6de016ab523f6606de1901ee785ac9525b96\", \"repository\"=>\"git@",
        "object_id": 70221735439060
      }
    },
    {
      "id": 63982,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "JSON::Ext::Parser",
      "method_id": "parse",
      "path": "JSON::Ext::Parser#parse",
      "static": false,
      "parameters": [],
      "receiver": {
        "class": "JSON::Ext::Parser",
        "object_id": 70221735437260,
        "value": "#<JSON::Ext::Parser:0x00007fbb8b314798>"
      }
    },
    {
      "id": 63983,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63982,
      "elapsed": 0.000006,
      "return_value": {
        "class": "Hash",
        "value": "{\"labels\"=>[\"label1\", \"positive\"]}",
        "object_id": 70221735438820
      }
    },
    {
      "id": 63984,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "JSON::Ext::Parser",
      "method_id": "parse",
      "path": "JSON::Ext::Parser#parse",
      "static": false,
      "parameters": [],
      "receiver": {
        "class": "JSON::Ext::Parser",
        "object_id": 70221735459840,
        "value": "#<JSON::Ext::Parser:0x00007fbb8b31f800>"
      }
    },
    {
      "id": 63985,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63984,
      "elapsed": 0.000006,
      "return_value": {
        "class": "Hash",
        "value": "{\"labels\"=>[\"label1\", \"label2\", \"negative\"]}",
        "object_id": 70221735458780
      }
    },
    {
      "id": 63986,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63965,
      "elapsed": 0.01404,
      "return_value": {
        "class": "Array",
        "value": "[#<struct Scenario::ApiItem mapset_id=100001, scenario_uuid=\"724151a3-cc7b-4ef3-ac6b-5380fe59217c\", ",
        "object_id": 70221734959340
      }
    },
    {
      "id": 63987,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "JSON::Ext::Generator::State",
      "method_id": "generate",
      "path": "JSON::Ext::Generator::State#generate",
      "static": false,
      "parameters": [
        {
          "name": "arg",
          "class": "Array",
          "object_id": 70221735475640,
          "value": "[{\"mapset_id\"=>100001, \"scenario_uuid\"=>\"724151a3-cc7b-4ef3-ac6b-5380fe59217c\", \"code_objects\"=>[\"mo",
          "kind": "req"
        }
      ],
      "receiver": {
        "class": "JSON::Ext::Generator::State",
        "object_id": 70221735473240,
        "value": "#<JSON::Ext::Generator::State:0x00007fbb8b3260b0>"
      }
    },
    {
      "id": 63988,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63987,
      "elapsed": 0.000106,
      "return_value": {
        "class": "String",
        "value": "[{\"mapset_id\":100001,\"scenario_uuid\":\"724151a3-cc7b-4ef3-ac6b-5380fe59217c\",\"code_objects\":[\"models/",
        "object_id": 70221735486800
      }
    },
    {
      "id": 63989,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63964,
      "elapsed": 0.014616,
      "return_value": {
        "class": "String",
        "value": "[{\"mapset_id\":100001,\"scenario_uuid\":\"724151a3-cc7b-4ef3-ac6b-5380fe59217c\",\"code_objects\":[\"models/",
        "object_id": 70221735486800
      }
    },
    {
      "id": 63990,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63947,
      "elapsed": 0.030991,
      "http_server_response": {
        "status": 200,
        "mime_type": "application/json; charset=utf-8"
      }
    },
    {
      "id": 63991,
      "event": "call",
      "thread_id": 70223206228000,
      "defined_class": "JSON::Ext::Parser",
      "method_id": "parse",
      "path": "JSON::Ext::Parser#parse",
      "static": false,
      "parameters": [],
      "receiver": {
        "class": "JSON::Ext::Parser",
        "object_id": 70221735503800,
        "value": "#<JSON::Ext::Parser:0x00007fbb8b334f70>"
      }
    },
    {
      "id": 63992,
      "event": "return",
      "thread_id": 70223206228000,
      "parent_id": 63991,
      "elapsed": 0.000027,
      "return_value": {
        "class": "Array",
        "value": "[{\"mapset_id\"=>100001, \"scenario_uuid\"=>\"724151a3-cc7b-4ef3-ac6b-5380fe59217c\", \"code_objects\"=>[\"mo",
        "object_id": 70221735502500
      }
    }
  ]
}